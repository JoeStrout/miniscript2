==== MiniScript Integration Test Suite
==== This file defines a number of small tests of basic MiniScript compiler
==== and execution tests.  Lines that begin with `====` are comments, but
==== also define test blocks.  A test block is one or more lines that do not
==== start with `====`.  A test block is further divided into input and
==== output, separated by a line starting with `----`.
====
==== The integration test runner should try each test with a fresh MiniScript
==== context, and compare the actual print output to the expected output,
==== flagging a test failure if they do not match.
====
================================================================================
==== SECTION 0: BASIC STATEMENT/COMMENT PARSING
================================================================================
print 42
--------------------------------
42
================================
// Here is a comment all on its own line.
print 123  // and here is a comment after a statement
// Followed by another full-line comment.
--------------------------------
123
================================
// several statements separated by semicolons:
print 1; print 2; print 3
print 4 // however; a semicolon in a comment; does nothing
print 5
--------------------------------
1
2
3
4
5
================================
==== Line continuation after comma, open (, [, or {, or binary operator
================================
print [
  1, 2]
--------------------------------
[1, 2]
================================
print [1,
  2, 3]
--------------------------------
[1, 2, 3]
================================
print (
  6 * 7)
--------------------------------
42
================================
print 40 +
  5 - 3
--------------------------------
42
================================================================================
==== SECTION 1: NUMERIC ARITHMETIC
================================================================================
==== Basic integer operations
================================
print 2+2
--------------------------------
4
================================
print 1+2+3+4
--------------------------------
10
================================
print 100-25-25
--------------------------------
50
================================
print 6*7
--------------------------------
42
================================
print 2 + 3 * 4
--------------------------------
14
================================
print (2 + 3) * 4
--------------------------------
20
================================
print 2*3/4*28
--------------------------------
42
================================
==== Division always returns float in MiniScript
================================
print 7/2
--------------------------------
3.5
================================
print 10/4
--------------------------------
2.5
================================
==== Float arithmetic
================================
print 3.5 + 2.5
--------------------------------
6
================================
print 10.5 - 3.5
--------------------------------
7
================================
print 2.5 * 4
--------------------------------
10
================================
print 7.5 / 2.5
--------------------------------
3
================================
==== Mixed int/float
================================
print 5 + 2.5
print 10.0 - 3
--------------------------------
7.5
7
================================
==== Power operator
================================
print 2^3
--------------------------------
8
================================
print 5+2^3
--------------------------------
13
================================
print 2^10
--------------------------------
1024
================================
print -2^3 // ^ has higher precedence than -
--------------------------------
-8
================================
==== Note: MS 2.0 uses right-associativity for ^, different from MS 1.x
==== MS 1.x: 2^3^2 = (2^3)^2 = 64
==== MS 2.0: 2^3^2 = 2^(3^2) = 512
================================
print 2^3^2
--------------------------------
512
================================
==== Unary minus (see UNARY_MINUS_QUIRK.md)
================================
print -5
--------------------------------
-5
================================
print -3+45
--------------------------------
42
================================
print 45+-3
--------------------------------
42
================================
print 0 - -5
--------------------------------
5
================================
print (-5)
--------------------------------
-5
================================
print -(-5)
--------------------------------
5
================================
==== Modulo
================================
print 10 % 7
--------------------------------
3
================================
print 17 % 5
--------------------------------
2
================================
// mod with negative left operand produces negative result
print -10 % 7
--------------------------------
-3
================================
// negating right operand has no effect on sign
print 10 % -7
--------------------------------
3
================================
==== math-assignment operators
================================
score = 0
score += 12; print score
score -= 2; print score
score *= 3; print score
score /= 5; print score
score %= 4; print score
score ^= 3; print score
// f = function; globals.score += 15; end function
// f; print score
----------------------------------------------------------------------
12
10
30
6
2
8
================================
==== Number formatting
==== (Matching MiniScript 1.x: 1-6 digits after decimal, exponential for very large/small)
================================
// Repeating decimals should show 6 digits after decimal point
print 10/3
--------------------------------
3.333333
================================
print 1/3
--------------------------------
0.333333
================================
// Trailing zeros should be trimmed (but keep at least one digit after decimal)
print 2.50
--------------------------------
2.5
================================
print 3.10
--------------------------------
3.1
================================
// Integer-valued doubles print as integers
print 1.0
--------------------------------
1
================================
print 6.0/2.0
--------------------------------
3
================================
// Negative zero should print as "0"
print 0-0.0
--------------------------------
0
================================
// Very small numbers use exponential format
print 1/10000000
--------------------------------
1.000000E-07
================================
// Numbers with exactly 6 decimal places
print 123.456789
--------------------------------
123.456789
================================
================================================================================
==== SECTION 2: STRING OPERATIONS
================================================================================
==== String literals
================================
print "hello"
--------------------------------
hello
================================
print "Hello World"
--------------------------------
Hello World
================================
print ""
--------------------------------

================================
print "She said ""hi"" to me"
--------------------------------
She said "hi" to me
================================
print "use """" for a quote"
--------------------------------
use "" for a quote
================================
==== String concatenation
================================
print "a" + "b"
--------------------------------
ab
================================
print "Hello" + " " + "World"
--------------------------------
Hello World
================================
==== String + number coercion
================================
print "x" + 5
--------------------------------
x5
================================
print "value: " + 42
--------------------------------
value: 42
================================
print 42 + " is the answer"
--------------------------------
42 is the answer
================================
print "" + 42
--------------------------------
42
================================
==== String replication
================================
print "ab" * 3
--------------------------------
ababab
================================
print "x" * 5
--------------------------------
xxxxx
================================
print "test" * 1
--------------------------------
test
================================
print "test" * 0
--------------------------------

================================
==== Fractional string replication
================================
print "abcd" * 0.5
--------------------------------
ab
================================
print "abcd" * 1.5
--------------------------------
abcdab
================================
print "abcdef" * 0.5
--------------------------------
abc
================================
==== String division (same as * inverse)
================================
print "abcd" / 2
--------------------------------
ab
================================
print "abcdef" / 2
--------------------------------
abc
================================
==== String subtraction (chop)
================================
print "Hello World" - " World"
--------------------------------
Hello
================================
print "Hello World" - "Hello "
--------------------------------
Hello World
================================
print "abcabc" - "abc"
--------------------------------
abc
================================
print "abcabc" - "cab"
--------------------------------
abcabc
================================
print "testing" - "ing"
--------------------------------
test
================================
print "hello" - "xyz"
--------------------------------
hello
================================
print "hello" - ""
--------------------------------
hello
================================
================================================================================
==== SECTION 3: LIST OPERATIONS
================================================================================
==== List literals
================================
print []
--------------------------------
[]
================================
print [1, 2, 3]
--------------------------------
[1, 2, 3]
================================
print [42]
--------------------------------
[42]
================================
==== Mixed type lists
====================================
print [1, "two", 3.5]
--------------------------------
[1, "two", 3.5]
================================
==== Nested lists
================================
print [[1, 2], [3, 4]]
--------------------------------
[[1, 2], [3, 4]]
================================
==== List indexing
================================
print [10, 20, 30][0]
--------------------------------
10
================================
print [10, 20, 30][1]
--------------------------------
20
================================
print [10, 20, 30][2]
--------------------------------
30
================================
==== Negative indexing
====================================
print [10, 20, 30][-1]
print [10, 20, 30][-2]
--------------------------------
30
20
================================
==== Nested list indexing
================================
print [[1, 2], [3, 4]][0]
--------------------------------
[1, 2]
================================
print [[1, 2], [3, 4]][1][0]
--------------------------------
3
================================
==== List concatenation
================================
print [1, 2] + [3, 4]
--------------------------------
[1, 2, 3, 4]
================================
print [1] + []
--------------------------------
[1]
================================
print [] + [2, 3]
--------------------------------
[2, 3]
================================
print [] + []
--------------------------------
[]
================================
print [1, "two"] + [3.5]
--------------------------------
[1, "two", 3.5]
================================
==== List replication
================================
print [1, 2, 3] * 3
--------------------------------
[1, 2, 3, 1, 2, 3, 1, 2, 3]
================================
print [1, 2] * 0
--------------------------------
[]
================================
print [1, 2] * 1
--------------------------------
[1, 2]
================================
print ["a", "b"] * 2
--------------------------------
["a", "b", "a", "b"]
================================
==== List division
================================
print [1, 2, 3, 4, 5, 6] / 2
--------------------------------
[1, 2, 3]
================================
print [1, 2, 3, 4] / 2
--------------------------------
[1, 2]
================================
print [1, 2, 3, 4, 5, 6] / 3
--------------------------------
[1, 2]
================================
================================================================================
==== SECTION 4: MAP OPERATIONS
================================================================================
==== Map literals
================================
print {}
--------------------------------
{}
================================
print {"a": 1}
--------------------------------
{"a": 1}
================================
print {"x": 10, "y": 20}
--------------------------------
{"x": 10, "y": 20}
================================
==== Map indexing
================================
print {"a": 1}["a"]
--------------------------------
1
================================
print {"x": 10, "y": 20}["y"]
--------------------------------
20
================================
==== Numeric keys
================================
print {1: "one", 2: "two"}[1]
--------------------------------
one
================================
print {1: "one", 2: "two"}[2]
--------------------------------
two
================================
==== Mixed key types
================================
print {"name": "test", 1: "one"}["name"]
--------------------------------
test
================================
==== Map addition
================================
m = {"a": 1} + {"b": 2}
print m.a
print m.b
--------------------------------
1
2
================================
m = {"a": 1, "b": 2} + {"b": 3}
print m.a
print m.b
--------------------------------
1
3
================================
print {"a": 1} + {}
--------------------------------
{"a": 1}
================================
print {} + {"a": 1}
--------------------------------
{"a": 1}
================================
print {} + {}
--------------------------------
{}
================================
==== Map iteration (for-in)
================================
m = {"x": 42}
for kv in m; print kv.key + "=" + kv.value; end for
--------------------------------
x=42
================================
count = 0
for kv in {"a":1, "b":2, "c":3}; count = count + 1; end for
print count
--------------------------------
3
================================
for kv in {}; print "nope"; end for
print "done"
--------------------------------
done
================================
================================================================================
==== SECTION 5: COMPARISON OPERATIONS
================================================================================
==== Numeric comparisons
================================
print 5 < 10
--------------------------------
1
================================
print 10 < 5
--------------------------------
0
================================
print 5 > 3
--------------------------------
1
================================
print 3 > 5
--------------------------------
0
================================
print 5 <= 5
--------------------------------
1
================================
print 5 <= 6
--------------------------------
1
================================
print 5 >= 5
--------------------------------
1
================================
print 5 >= 4
--------------------------------
1
================================
print 5 == 5
--------------------------------
1
================================
print 5 == 6
--------------------------------
0
================================
print 5 != 6
--------------------------------
1
================================
print 5 != 5
--------------------------------
0
================================
==== Float comparisons
================================
print 3.14 < 3.15
--------------------------------
1
================================
print 2.5 == 2.5
--------------------------------
1
================================
==== Int/float equality
================================
print 5 == 5.0
--------------------------------
1
================================
==== String comparisons (lexicographic)
================================
print "apple" < "banana"
--------------------------------
1
================================
print "banana" < "apple"
--------------------------------
0
================================
print "apple" == "apple"
--------------------------------
1
================================
print "apple" != "banana"
--------------------------------
1
================================
print "a" < "b"
--------------------------------
1
================================
print "abc" < "abd"
--------------------------------
1
================================
================================================================================
==== SECTION 6: LOGICAL OPERATIONS
================================================================================
==== AND operator
====================================
print 1 and 1
--------------------------------
1
====================================
print 1 and 0
--------------------------------
0
====================================
print 0 and 1
--------------------------------
0
====================================
print 0.5 and 1
--------------------------------
0.5
====================================
print 0.5 and 0.5
--------------------------------
0.25
====================================
print 0.5 and -0.5
--------------------------------
0.25
====================================
print 1.5 and 0.5
--------------------------------
0.75
====================================
print -0.5 and -0.5
--------------------------------
0.25
================================================================================
==== OR operator
====================================
print 1 or 0
--------------------------------
1
====================================
print 0 or 1
--------------------------------
1
====================================
print 0 or 0
--------------------------------
0
====================================
print 0.5 or 1
--------------------------------
1
====================================
print 0.5 or 0.5
--------------------------------
0.75
====================================
print -0.1 or -0.5
--------------------------------
0.65
====================================
print -0.5 or 0.5
--------------------------------
0.25
================================================================================
==== NOT operator
====================================
print not 0
--------------------------------
1
====================================
print not 1
--------------------------------
0
====================================
print not 0.25
--------------------------------
0.75
====================================
print not -0.1
--------------------------------
0.9
====================================
print not 42
--------------------------------
0
================================================================================
==== SECTION 7: MULTI-LINE TESTS
================================================================================
==== Multiple print statements
================================
print "Hello"
print "World"
--------------------------------
Hello
World
================================
print 1
print 2
print 3
--------------------------------
1
2
3
================================
================================================================================
==== SECTION 8: VARIABLE TESTS
================================================================================
==== Basic variable assignment and read
================================
x = 42
print x
--------------------------------
42
================================
x = "hello"
print x
--------------------------------
hello
================================
==== Multiple variables
================================
x = 10
y = 20
print x + y
--------------------------------
30
================================
a = 5
b = 3
c = a * b
print c
--------------------------------
15
================================
==== Variable reassignment
================================
x = 1
print x
x = 2
print x
x = 3
print x
--------------------------------
1
2
3
================================
x = 10
x = x + 5
print x
--------------------------------
15
================================
x = 2
x = x * x
print x
--------------------------------
4
================================
==== Variables in expressions
================================
x = 6
y = 7
print x * y
--------------------------------
42
================================
a = 100
b = 58
print a - b
--------------------------------
42
================================
x = 10
y = 4
print x / y + x % y
--------------------------------
4.5
================================
==== Variables with different types
================================
n = 42
s = "answer"
print s + ": " + n
--------------------------------
answer: 42
================================
x = 3.14159
print x * 2
--------------------------------
6.28318
================================
==== Variables in comparisons
================================
x = 5
y = 10
print x < y
--------------------------------
1
================================
a = 42
b = 42
print a == b
--------------------------------
1
================================
==== Variables in logical operations
================================
x = 1
y = 0
print x and y
--------------------------------
0
================================
x = 0
y = 1
print x or y
--------------------------------
1
================================
==== Variables with lists
================================
x = [1, 2, 3]
print x
--------------------------------
[1, 2, 3]
================================
x = [10, 20, 30]
print x[1]
--------------------------------
20
================================
==== Variables with maps
================================
m = {"x": 10}
print m
--------------------------------
{"x": 10}
================================
m = {"a": 1, "b": 2}
print m["a"]
print m["b"]
--------------------------------
1
2
================================
==== Equality tests: strings
================================
s1 = "abc"
s1c = s1
s2 = "ab" + "c"
s3 = "abQ"
s4 = "ab"
s5 = "abcd"
print "s1 == s1c: " + (s1 == s1c)
print "s1 == s2: " + (s1 == s2)
print "s1 == s3: " + (s1 == s3)
print "s1 == s4: " + (s1 == s4)
print "s1 == s5: " + (s1 == s5)
--------------------------------
s1 == s1c: 1
s1 == s2: 1
s1 == s3: 0
s1 == s4: 0
s1 == s5: 0
================================
==== Equality tests: maps
================================
m1 = {"a": 1, "b": 2}
m1c = m1
m2 = {"a": 1, "b": 2}
m3 = {"a": 1, "b": 1234}
m4 = {"a": 1}
m5 = {"a": 1, "b": 2, "c": 3}
print "m1 == m1c: " + (m1 == m1c)
print "m1 == m2: " + (m1 == m2)
print "m1 == m3: " + (m1 == m3)
print "m1 == m4: " + (m1 == m4)
print "m1 == m5: " + (m1 == m5)
--------------------------------
m1 == m1c: 1
m1 == m2: 1
m1 == m3: 0
m1 == m4: 0
m1 == m5: 0
================================
==== Equality tests: lists
================================
n1 = [1, 2]
n1c = n1
n2 = [1, 2]
n3 = [1, 1234]
n4 = [1]
n5 = [1, 2, 3]
print "n1 == n1c: " + (n1 == n1c)
print "n1 == n2: " + (n1 == n2)
print "n1 == n3: " + (n1 == n3)
print "n1 == n4: " + (n1 == n4)
print "n1 == n5: " + (n1 == n5)
--------------------------------
n1 == n1c: 1
n1 == n2: 1
n1 == n3: 0
n1 == n4: 0
n1 == n5: 0
================================================================================
==== SECTION 9: WHILE LOOPS
================================================================================
==== Basic while loop
================================
x = 1
while x < 4
	print x
	x = x + 1
end while
--------------------------------
1
2
3
================================
==== While loop with accumulator
================================
sum = 0
i = 1
while i <= 5
	sum = sum + i
	i = i + 1
end while
print sum
--------------------------------
15
================================
==== While loop - zero iterations (condition false from start)
================================
x = 10
while x < 5
	print "should not print"
end while
print "done"
--------------------------------
done
================================
==== While loop - single iteration
================================
x = 0
while x < 1
	print "once"
	x = x + 1
end while
--------------------------------
once
================================
==== Nested while loops
================================
i = 1
while i <= 2
	j = 1
	while j <= 3
		print i * 10 + j
		j = j + 1
	end while
	i = i + 1
end while
--------------------------------
11
12
13
21
22
23
================================
================================================================================
==== SECTION 10: IF STATEMENTS
================================================================================
==== Single-line if (no else)
================================
x = 5
if x > 3 then print "big"
--------------------------------
big
================================
x = 1
if x > 3 then print "big"
print "done"
--------------------------------
done
================================
==== Single-line if with else
================================
x = 5
if x > 10 then print "very big" else print "not so big"
--------------------------------
not so big
================================
x = 20
if x > 10 then print "very big" else print "not so big"
--------------------------------
very big
================================
x = 15
if x > 10 then if x < 20 then print "mid" else print "not mid"
--------------------------------
mid
================================
==== Block if (no else)
================================
x = 5
if x == 5 then
	print "x is five"
end if
--------------------------------
x is five
================================
x = 3
if x == 5 then
	print "x is five"
end if
print "done"
--------------------------------
done
================================
==== Block if with else
================================
x = -3
if x < 0 then
	print "negative"
else
	print "non-negative"
end if
--------------------------------
negative
================================
x = 7
if x < 0 then
	print "negative"
else
	print "non-negative"
end if
--------------------------------
non-negative
================================
==== Block if/else if/else chains
================================
x = -5
if x < 0 then
	print "negative"
else if x == 0 then
	print "zero"
else
	print "positive"
end if
--------------------------------
negative
================================
x = 0
if x < 0 then
	print "negative"
else if x == 0 then
	print "zero"
else
	print "positive"
end if
--------------------------------
zero
================================
x = 10
if x < 0 then
	print "negative"
else if x == 0 then
	print "zero"
else
	print "positive"
end if
--------------------------------
positive
================================
==== Multiple else if branches
================================
score = 85
if score >= 90 then
	print "A"
else if score >= 80 then
	print "B"
else if score >= 70 then
	print "C"
else if score >= 60 then
	print "D"
else
	print "F"
end if
--------------------------------
B
================================
score = 55
if score >= 90 then
	print "A"
else if score >= 80 then
	print "B"
else if score >= 70 then
	print "C"
else if score >= 60 then
	print "D"
else
	print "F"
end if
--------------------------------
F
================================
==== Nested if statements
================================
a = 3
b = 7
if a > 0 then
	if b > 5 then
		print "a>0 and b>5"
	else
		print "a>0 and b<=5"
	end if
end if
--------------------------------
a>0 and b>5
================================
a = 3
b = 2
if a > 0 then
	if b > 5 then
		print "a>0 and b>5"
	else
		print "a>0 and b<=5"
	end if
end if
--------------------------------
a>0 and b<=5
================================
==== If inside while loop
================================
i = 0
while i < 5
	if i == 2 then print "two"
	i = i + 1
end while
--------------------------------
two
================================
i = 1
while i <= 3
	if i == 1 then
		print "one"
	else if i == 2 then
		print "two"
	else
		print "other"
	end if
	i = i + 1
end while
--------------------------------
one
two
other
================================
==== While inside if statement
================================
x = 1
if x > 0 then
	i = 0
	while i < 3
		print i
		i = i + 1
	end while
end if
--------------------------------
0
1
2
================================
==== Truthiness/falsiness tests
================================
x = 0
if x then print "truthy" else print "falsy"
--------------------------------
falsy
================================
x = 1
if x then print "truthy" else print "falsy"
--------------------------------
truthy
================================
x = -1
if x then print "truthy" else print "falsy"
--------------------------------
truthy
================================
x = 0.5
if x then print "truthy" else print "falsy"
--------------------------------
truthy
================================
==== Logical operators in conditions
================================
x = 5
y = 10
if x > 0 and y > 0 then print "both positive"
--------------------------------
both positive
================================
x = -1
y = 5
if x > 0 or y > 0 then print "at least one positive"
--------------------------------
at least one positive
================================
x = 0
if not x then print "x is falsy"
--------------------------------
x is falsy
================================
s = "abc"
if s then print "truthy" else print "falsy"
--------------------------------
truthy
================================
s = ""
if s then print "truthy" else print "falsy"
--------------------------------
falsy
================================================================================
==== SECTION 11: BREAK STATEMENT
================================================================================
==== Basic break
================================
i = 0
while i < 10
	print i
	if i == 3 then break
	i = i + 1
end while
print "done"
--------------------------------
0
1
2
3
done
================================
==== Break at start of loop
================================
i = 0
while i < 5
	if i == 0 then break
	print "should not print"
	i = i + 1
end while
print "exited"
--------------------------------
exited
================================
==== Break in nested loops (only exits innermost)
================================
i = 0
while i < 3
	j = 0
	while j < 5
		if j == 2 then break
		print i * 10 + j
		j = j + 1
	end while
	i = i + 1
end while
--------------------------------
0
1
10
11
20
21
================================
==== Break with block if
================================
i = 0
while i < 10
	if i > 2 then
		print "breaking"
		break
	end if
	print i
	i = i + 1
end while
--------------------------------
0
1
2
breaking
================================================================================
==== SECTION 12: FOR LOOPS
================================================================================
==== Basic for loop over list
================================
for i in [1, 2, 3]
	print i
end for
--------------------------------
1
2
3
================================
==== For loop over string
================================
for c in "abc"
	print c
end for
--------------------------------
a
b
c
================================
==== For loop with break
================================
for i in [1, 2, 3, 4, 5]
	if i == 3 then break
	print i
end for
print "done"
--------------------------------
1
2
done
================================
==== Nested for loops
================================
for i in [1, 2]
	for j in [10, 20]
		print i * 100 + j
	end for
end for
--------------------------------
110
120
210
220
================================
==== Empty list
================================
for i in []
	print "should not print"
end for
print "done"
--------------------------------
done
================================
==== For loop variable persists after loop
================================
for x in [5, 6, 7]
	y = x + 1
end for
print x + y  // 7 + 8 == 15
--------------------------------
15
================================================================================
==== SECTION 13: CONTINUE STATEMENT
================================================================================
==== Continue in while loop
================================
i = 0
while i < 5
	i = i + 1
	if i == 3 then continue
	print i
end while
--------------------------------
1
2
4
5
================================
==== Continue in for loop
================================
for x in [1, 2, 3, 4, 5]
	if x == 3 then continue
	print x
end for
--------------------------------
1
2
4
5
================================
==== Continue skips rest of body
================================
i = 0
while i < 3
	i = i + 1
	print "before"
	continue
	print "after"
end while
--------------------------------
before
before
before
================================
==== Continue in nested loops (only affects innermost)
================================
for i in [1, 2]
	for j in [10, 20, 30]
		if j == 20 then continue
		print i * 100 + j
	end for
end for
--------------------------------
110
130
210
230
================================================================================
==== SECTION 14: ERROR CASES
================================================================================
==== Runtime error: key not found in map
================================
m = {"a": 1}
print m["b"]
--------------------------------
Runtime Error: Key Not Found: 'b' not found in map
================================
==== Runtime error: index into non-collection
================================
x = 42
print x[0]
--------------------------------
Runtime Error: Can't index into 42
================================
==== Compiler error: break outside loop
================================
break
--------------------------------
Compiler Error: 'break' without open loop block
================================
==== Compiler error: continue outside loop
================================
continue
--------------------------------
Compiler Error: 'continue' without open loop block
================================================================================
==== SECTION 15: FUNCTIONS
================================================================================
==== Basic function definition and call
================================
f = function(x)
	return x * 2
end function
print f(21)
--------------------------------
42
================================
==== Function with multiple params
================================
add = function(x, y)
	return x + y
end function
print add(3, 4)
--------------------------------
7
================================
==== Function with no params (with and without parentheses)
================================
greet = function()
	return "hello"
end function
print greet
--------------------------------
hello
================================
greet2 = function
	return "howdy"
end function
print greet2()
--------------------------------
howdy
================================
==== Return from inside if
================================
f = function(x)
	if x > 0 then return x
	return 0
end function
print f(5)
print f(-3)
--------------------------------
5
0
================================
==== Function with loop
================================
sumTo = function(n)
	result = 0
	i = 1
	while i <= n
		result = result + i
		i = i + 1
	end while
	return result
end function
print sumTo(5)
--------------------------------
15
================================
==== Multiple functions
================================
double = function(x)
	return x * 2
end function
triple = function(x)
	return x * 3
end function
print double(7)
print triple(7)
--------------------------------
14
21
================================
==== Function with multiple arguments (no paren)
================================
printSum = function(x, y)
	print x + y
end function
printSum 10, 32
--------------------------------
42
================================
==== Functions as part of a list or map literal
================================
funcs = [function(x); return x*2; end function,
  function(x)
    return x*3
  end function]
print funcs[0](10)
print funcs[1](10)
--------------------------------
20
30
================================
==== Function with default parameter values
================================
f = function(x, y=10)
	return x + y
end function
print f(5)
print f(5, 20)
--------------------------------
15
25
================================
==== Bare return (implictly returns null)
================================
foo = function; print "foo"; return; end function
x = foo
print (x == null)
--------------------------------
foo
1
================================
==== No return statement (implictly returns null)
================================
foo = function; print "foo"; end function
x = foo
print (x == null)
--------------------------------
foo
1
================================
==== Recursive function
================================
fib = function(n)
	if n < 3 then return 1
	return fib(n-1) + fib(n-2)
end function
print fib(6)
--------------------------------
8
================================
==== Function reference (suppress invocation)
================================
f = function(times=3); print "Spam" * times; end function
g = @f
f
g 5
--------------------------------
SpamSpamSpam
SpamSpamSpamSpamSpam
================================
==== Default string parameter
================================
f = function(s="hi")
	return s
end function
print f
print f("bye")
--------------------------------
hi
bye
================================
==== Default true/false/null
================================
f = function(a=true, b=false, c=null)
	print a
	print b
	print c
end function
f
--------------------------------
1
0
null
================================
==== Negative number default
================================
f = function(x=-5)
	return x
end function
print f
--------------------------------
-5
================================
==== Computed (but still constant)  default
================================
f = function(x=6*7)
	return x
end function
print f
--------------------------------
42
================================
==== Default list (frozen)
================================
f = function(x=[1, 2, 3])
	return x
end function
print f
print isFrozen(f)
--------------------------------
[1, 2, 3]
1
================================
==== Default map (frozen)
================================
f = function(m={"a": 1})
	return m
end function
print f
print isFrozen(f)
--------------------------------
{"a": 1}
1
================================
==== Omitted args get null
================================
f = function(a, b=10)
	print a
	print b
end function
f
--------------------------------
null
10
================================
==== Multiple defaults, some omitted
================================
f = function(a=1, b=2, c=3)
	return a + b + c
end function
print f
print f(10)
print f(10, 20)
print f(10, 20, 30)
--------------------------------
6
15
33
60
================================================================================
==== SECTION 16: FROZEN VALUES
================================================================================
==== isFrozen on unfrozen list and map
================================
x = [1, 2, 3]
print isFrozen(x)
m = {"a": 1}
print isFrozen(m)
--------------------------------
0
0
================================
==== freeze a list, verify isFrozen
================================
x = [1, 2, 3]
freeze x
print isFrozen(x)
--------------------------------
1
================================
==== freeze a map, verify isFrozen
================================
m = {"a": 1}
freeze m
print isFrozen(m)
--------------------------------
1
================================
==== frozen list: remove raises error
================================
x = [1, 2, 3]
freeze x
remove x, 0
--------------------------------
Runtime Error: Attempt to modify a frozen list
================================
==== frozen map: remove raises error
================================
m = {"a": 1, "b": 2}
freeze m
remove m, "a"
--------------------------------
Runtime Error: Attempt to modify a frozen map
================================
==== freeze is recursive
================================
inner = [10, 20]
outer = [inner, 30]
freeze outer
print isFrozen(inner)
--------------------------------
1
================================
==== frozenCopy returns frozen copy without affecting original
================================
x = [1, 2, 3]
y = frozenCopy(x)
print isFrozen(x)
print isFrozen(y)
--------------------------------
0
1
================================
==== frozenCopy of already-frozen returns same value
================================
x = [1, 2, 3]
freeze x
y = frozenCopy(x)
print isFrozen(y)
--------------------------------
1
================================
==== isFrozen on non-collection returns false
================================
print isFrozen(42)
print isFrozen("hello")
print isFrozen(null)
--------------------------------
0
0
0
================================
================================================================================
==== SECTION 17: INDEXED ASSIGNMENT
================================================================================
==== List indexed assignment
================================
lst = [1, 2, 3]
lst[1] = 42
print lst[1]
--------------------------------
42
================================
==== Map indexed assignment (new key)
================================
m = {}
m["foo"] = "bar"
print m["foo"]
--------------------------------
bar
================================
==== Map indexed assignment (overwrite existing key)
================================
m = {"a": 1, "b": 2}
m["a"] = 99
print m["a"]
print m["b"]
--------------------------------
99
2
================================
==== Chained indexed assignment
================================
lst = [[0, 0], [0, 0]]
lst[1][0] = 42
(lst[0])[1] = 123
print lst
--------------------------------
[[0, 123], [42, 0]]
================================
==== Indexed assignment in loop
================================
lst = [0, 0, 0]
for i in [0, 1, 2]
	lst[i] = i * 10
end for
print lst
--------------------------------
[0, 10, 20]
================================
==== Indexed assignment with variable key
================================
m = {}
key = "hello"
m[key] = "world"
print m["hello"]
--------------------------------
world
================================
================================================================================
==== SECTION 18: DOT SYNTAX
================================================================================
==== Basic member access (rvalue)
================================
m = {"x": 10}
print m.x
--------------------------------
10
================================
==== Member assignment (lvalue)
================================
m = {}
m.name = "Bob"
print m.name
--------------------------------
Bob
================================
==== Chained dot access
================================
m = {"a": {"b": 5}}
print m.a.b
--------------------------------
5
================================
==== Dot access and bracket access are equivalent
================================
m = {"key": 42}
print m.key
print m["key"]
--------------------------------
42
42
================================
==== Dot assignment then bracket read and vice versa
================================
m = {}
m.x = 1
print m["x"]
m["y"] = 2
print m.y
--------------------------------
1
2
================================
==== Dot access on nested maps with assignment
================================
m = {"inner": {}}
m.inner.val = 99
print m.inner.val
--------------------------------
99
================================================================================
==== SECTION 19: OBJECT-ORIENTED PROGRAMMING
================================================================================
==== `new` operator sets __isa
================================
Animal = {"legs": 4, "tails": 1}
duck = new Animal
print "len: " + len(duck)
print "__isa check: " + (duck.__isa == Animal)
--------------------------------
len: 1
__isa check: 1
================================
==== inheritance/override with manual construction
================================
Animal = {"legs": 4, "tails": 1}
dog = {"__isa": Animal}
duck = {"__isa": Animal, "legs": 2}
print dog.legs
print duck.legs
--------------------------------
4
2
================================
==== inheritance & override with `new`
================================
Animal = {"legs": 4, "tails": 1}
dog = new Animal
duck = new Animal
duck.legs = 2
print dog.legs
print duck.legs
--------------------------------
4
2
================================
==== isa operator: identity
================================
Animal = {"legs": 4}
print Animal isa Animal
--------------------------------
1
================================
==== isa operator: direct parent
================================
Animal = {"legs": 4}
duck = new Animal
print duck isa Animal
--------------------------------
1
================================
==== isa operator: multi-level chain
================================
Animal = {"legs": 4}
Bird = new Animal
duck = new Bird
print duck isa Bird
print duck isa Animal
--------------------------------
1
1
================================
==== isa operator: unrelated map
================================
Animal = {"legs": 4}
Vehicle = {"wheels": 4}
duck = new Animal
print duck isa Vehicle
--------------------------------
0
================================
==== isa operator: non-map lhs
================================
Animal = {"legs": 4}
print 42 isa Animal
print "hello" isa Animal
--------------------------------
0
0
================================
==== self: dot-syntax method call
================================
Animal = {}
Animal.speak = function
	return "I am " + self.name
end function
dog = new Animal
dog.name = "Rex"
print dog.speak
--------------------------------
I am Rex
================================
==== self: bracket-syntax method call
================================
Animal = {}
Animal.greet = function
	return "Hello from " + self.name
end function
cat = new Animal
cat.name = "Whiskers"
f = "greet"
print cat[f]
--------------------------------
Hello from Whiskers
================================
==== self: method inherited via __isa chain
================================
Animal = {}
Animal.describe = function
	return self.sound
end function
Dog = new Animal
Dog.sound = "woof"
fido = new Dog
fido.sound = "bark"
print fido.describe
print Dog.describe
--------------------------------
bark
woof
================================
==== super: accessing parent method
================================
Animal = {}
Animal.speak = function
	return "generic sound"
end function
Dog = new Animal
Dog.speak = function
	return "dog says: " + super.speak
end function
d = new Dog
print d.speak
--------------------------------
dog says: generic sound
================================
==== super.method() preserves self
================================
Animal = {}
Animal.name = "unknown"
Animal.identify = function
	return self.name
end function
Dog = new Animal
Dog.identify = function
	return "Dog: " + super.identify
end function
fido = new Dog
fido.name = "Fido"
print fido.identify
--------------------------------
Dog: Fido
================================
==== self in non-method call is null
================================
f = function
	return self
end function
print f
--------------------------------
null
================================
==== self in closure captures self
================================
Animal = {}
Animal.makeGreeter = function
	return function
		return "Hi, I'm " + self.name
	end function
end function
cat = new Animal
cat.name = "Luna"
greeter = cat.makeGreeter
print greeter
--------------------------------
Hi, I'm Luna
================================
==== multi-level super chain
================================
A = {}
A.whoami = function
	return "A"
end function
B = new A
B.whoami = function
	return "B>" + super.whoami
end function
C = new B
C.whoami = function
	return "C>" + super.whoami
end function
obj = new C
print obj.whoami
--------------------------------
C>B>A
================================
================================================================================
==== SECTION 20: SLICING
================================================================================
==== String slicing: basic range
================================
print "abcdef"[1:4]
--------------------------------
bcd
================================
==== String slicing: from start
================================
print "abcdef"[0:3]
--------------------------------
abc
================================
==== String slicing: to end
================================
print "abcdef"[3:6]
--------------------------------
def
================================
==== String slicing: negative index (from end)
================================
print "abcdef"[-3:-1]
--------------------------------
de
================================
==== String slicing: negative start, to end
================================
print "abcdef"[-2:6]
--------------------------------
ef
================================
==== String slicing: omit end (null means to end)
================================
s = "abcdef"
print s[2:null]
--------------------------------
cdef
================================
==== String slicing: omit start (null means from start)
================================
s = "abcdef"
print s[null:3]
--------------------------------
abc
================================
==== String slicing: single character (same as indexing)
================================
print "abcdef"[2:3]
--------------------------------
c
================================
==== String slicing: empty result (start == end)
================================
print "abcdef"[3:3]
--------------------------------

================================
==== String slicing: full string
================================
print "abcdef"[0:6]
--------------------------------
abcdef
================================
==== String indexing: single character
================================
print "hello"[0]
print "hello"[-1]
--------------------------------
h
o
================================
==== List slicing: basic range
================================
print [10, 20, 30, 40, 50][1:4]
--------------------------------
[20, 30, 40]
================================
==== List slicing: from start
================================
print [10, 20, 30, 40, 50][0:2]
--------------------------------
[10, 20]
================================
==== List slicing: to end
================================
print [10, 20, 30, 40, 50][3:5]
--------------------------------
[40, 50]
================================
==== List slicing: negative indices
================================
print [10, 20, 30, 40, 50][-3:-1]
--------------------------------
[30, 40]
================================
==== List slicing: negative start to end
================================
print [10, 20, 30, 40, 50][-2:5]
--------------------------------
[40, 50]
================================
==== List slicing: omit end (null means to end)
================================
lst = [10, 20, 30, 40, 50]
print lst[2:null]
--------------------------------
[30, 40, 50]
================================
==== List slicing: omit start (null means from start)
================================
lst = [10, 20, 30, 40, 50]
print lst[null:3]
--------------------------------
[10, 20, 30]
================================
==== List slicing: empty result (start == end)
================================
print [10, 20, 30][2:2]
--------------------------------
[]
================================
==== List slicing: full list
================================
print [10, 20, 30][0:3]
--------------------------------
[10, 20, 30]
================================
==== List slicing: single element
================================
print [10, 20, 30][1:2]
--------------------------------
[20]
================================
==== Slice of variable
================================
s = "Hello World"
print s[0:5]
print s[6:11]
--------------------------------
Hello
World
================================
==== List slice assigned to variable
================================
lst = [1, 2, 3, 4, 5]
mid = lst[1:4]
print mid
--------------------------------
[2, 3, 4]
================================
================================================================================
==== SECTION 21: NUMERIC INTRINSICS
================================================================================
==== abs
================================
print abs(-42)
--------------------------------
42
================================
print abs(42)
--------------------------------
42
================================
print abs(0)
--------------------------------
0
================================
==== acos
================================
print acos(1)
--------------------------------
0
================================
// acos(0) returns pi/2
print round(acos(0), 6)
--------------------------------
1.570796
================================
==== asin
================================
print asin(0)
--------------------------------
0
================================
print round(asin(1), 6)
--------------------------------
1.570796
================================
==== atan
================================
print atan(0)
--------------------------------
0
================================
print round(atan(1), 6)
--------------------------------
0.785398
================================
// atan with two arguments (y, x)
print round(atan(1, -1), 6)
--------------------------------
2.356194
================================
==== ceil
================================
print ceil(41.2)
--------------------------------
42
================================
print ceil(-41.2)
--------------------------------
-41
================================
print ceil(42)
--------------------------------
42
================================
==== cos
================================
print cos(0)
--------------------------------
1
================================
print round(cos(pi), 6)
--------------------------------
-1
================================
==== floor
================================
print floor(42.9)
--------------------------------
42
================================
print floor(-42.9)
--------------------------------
-43
================================
print floor(42)
--------------------------------
42
================================
==== log
================================
print round(log(1000), 6)
--------------------------------
3
================================
print round(log(256, 2), 6)
--------------------------------
8
================================
==== pi
================================
print round(pi, 6)
--------------------------------
3.141593
================================
==== round
================================
print round(pi, 2)
--------------------------------
3.14
================================
print round(12345, -3)
--------------------------------
12000
================================
print round(2.5)
--------------------------------
3
================================
==== rnd (seeded for reproducibility)
================================
rnd 42
x = rnd
print (x >= 0 and x < 1)
--------------------------------
1
================================
==== sign
================================
print sign(-42.6)
--------------------------------
-1
================================
print sign(42)
--------------------------------
1
================================
print sign(0)
--------------------------------
0
================================
==== sin
================================
print sin(0)
--------------------------------
0
================================
print round(sin(pi/2), 6)
--------------------------------
1
================================
==== sqrt
================================
print sqrt(1764)
--------------------------------
42
================================
print sqrt(0)
--------------------------------
0
================================
print sqrt(1)
--------------------------------
1
================================
==== tan
================================
print tan(0)
--------------------------------
0
================================
print round(tan(pi/4), 6)
--------------------------------
1
================================
================================================================================
==== SECTION 22: STRING INTRINSICS
================================================================================
==== str: number to string
================================
print str(42)
--------------------------------
42
================================
print str(3.14)
--------------------------------
3.14
================================
==== str: null returns empty string
================================
print str(null)
--------------------------------

================================
==== str: string passes through
================================
print str("hello")
--------------------------------
hello
================================
==== str: no argument returns empty string
================================
print str
--------------------------------

================================
==== val: string to number
================================
print val("1234.56")
--------------------------------
1234.56
================================
print val("42")
--------------------------------
42
================================
==== val: number passes through
================================
print val(42)
--------------------------------
42
================================
print val(3.14)
--------------------------------
3.14
================================
==== val: non-parseable string returns 0
================================
print val("hello")
--------------------------------
0
================================
==== val: list/map returns null
================================
print val([1,2,3])
--------------------------------
null
================================
==== upper
================================
print upper("hello")
--------------------------------
HELLO
================================
print upper("Mo Spam")
--------------------------------
MO SPAM
================================
==== upper: non-string returns as-is
================================
print upper(42)
--------------------------------
42
================================
==== lower
================================
print lower("HELLO")
--------------------------------
hello
================================
print lower("Mo Spam")
--------------------------------
mo spam
================================
==== lower: non-string returns as-is
================================
print lower(42)
--------------------------------
42
================================
==== char: code point to character
================================
print char(42)
--------------------------------
*
================================
print char(65)
--------------------------------
A
================================
print char(97)
--------------------------------
a
================================
==== char: default is 65 (A)
================================
print char
--------------------------------
A
================================
==== code: character to code point
================================
print code("*")
--------------------------------
42
================================
print code("A")
--------------------------------
65
================================
print code("a")
--------------------------------
97
================================
==== code: takes first character of longer string
================================
print code("hello")
--------------------------------
104
================================
==== code: non-string returns 0
================================
print code(42)
--------------------------------
0
================================
================================================================================
==== SECTION 23: UNICODE STRINGS
================================================================================
==== Basic non-ASCII string literal
================================
print "caf"
--------------------------------
caf
================================
==== String length with non-ASCII
================================
print len("caf")
--------------------------------
4
================================
print len("")
--------------------------------
3
================================
==== String indexing with non-ASCII
================================
print "caf"[3]
--------------------------------

================================
print ""[1]
--------------------------------

================================
==== String slicing with non-ASCII
================================
print "caf"[0:3]
--------------------------------
caf
================================
print ""[1:3]
--------------------------------

================================
==== String concatenation with non-ASCII
================================
print "caf" + " crme"
--------------------------------
caf crme
================================
==== upper/lower with non-ASCII
================================
print upper("caf")
--------------------------------
CAF
================================
print lower("BER")
--------------------------------
ber
================================
==== char/code round-trip with non-ASCII
================================
print code("")
--------------------------------
233
================================
print char(233)
--------------------------------

================================
print code("")
--------------------------------
26085
================================
print char(26085)
--------------------------------

================================
==== char/code with emoji (surrogate pair)
================================
print code("")
--------------------------------
128512
================================
print char(128512)
--------------------------------

================================
==== String comparison with non-ASCII
================================
print "abc" < "bc"
--------------------------------
1
================================
print "caf" == "caf"
--------------------------------
1
================================
================================================================================
==== SECTION 24: LIST/MAP/STRING INTRINSICS
================================================================================
==== push: append to list
================================
lst = [1, 2, 3]
push lst, 4
print lst
--------------------------------
[1, 2, 3, 4]
================================
==== push: returns self
================================
lst = [1]
push lst, 2
push lst, 3
print lst
--------------------------------
[1, 2, 3]
================================
==== push: onto map (adds key with value 1)
================================
m = {}
push m, "x"
print m
--------------------------------
{"x": 1}
================================
==== pop: remove and return last element
================================
lst = [10, 20, 30]
print pop(lst)
print lst
--------------------------------
30
[10, 20]
================================
==== pop: empty list returns null
================================
lst = []
print pop(lst)
--------------------------------
null
================================
==== pull: remove and return first element
================================
lst = [10, 20, 30]
print pull(lst)
print lst
--------------------------------
10
[20, 30]
================================
==== pull: empty list returns null
================================
lst = []
print pull(lst)
--------------------------------
null
================================
==== insert: into list at index
================================
lst = [1, 2, 4]
insert lst, 2, 3
print lst
--------------------------------
[1, 2, 3, 4]
================================
==== insert: at beginning of list
================================
lst = [2, 3]
insert lst, 0, 1
print lst
--------------------------------
[1, 2, 3]
================================
==== insert: with negative index (-1 inserts at end)
================================
lst = [1, 2, 3]
insert lst, -1, 99
print lst
--------------------------------
[1, 2, 3, 99]
================================
==== insert: into string
================================
print insert("hllo", 1, "e")
--------------------------------
hello
================================
==== insert: at end of string
================================
print insert("hell", 4, "o")
--------------------------------
hello
================================
==== indexOf: list
================================
lst = [10, 20, 30, 20]
print indexOf(lst, 20)
print indexOf(lst, 99)
--------------------------------
1
null
================================
==== indexOf: list with after
================================
lst = [10, 20, 30, 20]
print indexOf(lst, 20, 1)
--------------------------------
3
================================
==== indexOf: string
================================
print indexOf("hello world", "world")
print indexOf("hello world", "xyz")
--------------------------------
6
null
================================
==== indexOf: string with after
================================
print indexOf("abcabc", "abc", 0)
--------------------------------
3
================================
==== indexOf: map (find key by value)
================================
m = {"a": 1, "b": 2, "c": 3}
print indexOf(m, 2)
--------------------------------
b
================================
==== sort: numeric list
================================
lst = [3, 1, 4, 1, 5, 9]
sort lst
print lst
--------------------------------
[1, 1, 3, 4, 5, 9]
================================
==== sort: string list
================================
lst = ["banana", "apple", "cherry"]
sort lst
print lst
--------------------------------
["apple", "banana", "cherry"]
================================
==== sort: descending
================================
lst = [1, 3, 2]
sort lst, null, false
print lst
--------------------------------
[3, 2, 1]
================================
==== sort: by key
================================
lst = [{"name": "Charlie", "age": 30}, {"name": "Alice", "age": 25}, {"name": "Bob", "age": 35}]
sort lst, "name"
print lst[0].name
print lst[1].name
print lst[2].name
--------------------------------
Alice
Bob
Charlie
================================
==== join: basic
================================
print join([1, 2, 3])
--------------------------------
1 2 3
================================
==== join: with delimiter
================================
print join(["a", "b", "c"], "-")
--------------------------------
a-b-c
================================
==== join: with empty delimiter
================================
print join([1, 2, 3], "")
--------------------------------
123
================================
==== split: basic
================================
print split("one two three")
--------------------------------
["one", "two", "three"]
================================
==== split: with custom delimiter
================================
print split("a-b-c", "-")
--------------------------------
["a", "b", "c"]
================================
==== split: into characters
================================
print split("abc", "")
--------------------------------
["a", "b", "c"]
================================
==== split: with maxCount
================================
print split("a-b-c-d", "-", 2)
--------------------------------
["a", "b-c-d"]
================================
==== replace: in list
================================
lst = [1, 2, 3, 2, 1]
replace lst, 2, 99
print lst
--------------------------------
[1, 99, 3, 99, 1]
================================
==== replace: in string
================================
print replace("hello world", "o", "0")
--------------------------------
hell0 w0rld
================================
==== replace: in string with maxCount
================================
print replace("aaa", "a", "b", 2)
--------------------------------
bba
================================
==== replace: in map (replaces values)
================================
m = {"a": 1, "b": 2, "c": 1}
replace m, 1, 99
print m.a
print m.b
print m.c
--------------------------------
99
2
99
================================
==== sum: list
================================
print sum([1, 2, 3, 4, 5])
--------------------------------
15
================================
==== sum: map values
================================
print sum({"a": 10, "b": 20, "c": 30})
--------------------------------
60
================================
==== sum: empty list
================================
print sum([])
--------------------------------
0
================================
==== slice: list
================================
print slice([10, 20, 30, 40, 50], 1, 4)
--------------------------------
[20, 30, 40]
================================
==== slice: string
================================
print slice("hello world", 0, 5)
--------------------------------
hello
================================
==== slice: negative indices
================================
print slice([1, 2, 3, 4, 5], -3)
--------------------------------
[3, 4, 5]
================================
==== slice: default from=0
================================
print slice([10, 20, 30])
--------------------------------
[10, 20, 30]
================================
==== indexes: list
================================
print indexes([10, 20, 30])
--------------------------------
[0, 1, 2]
================================
==== indexes: string
================================
print indexes("abc")
--------------------------------
[0, 1, 2]
================================
==== indexes: map
================================
m = {"x": 1, "y": 2}
idx = indexes(m)
print indexOf(idx, "x") != null
print indexOf(idx, "y") != null
--------------------------------
1
1
================================
==== hasIndex: list
================================
lst = [10, 20, 30]
print hasIndex(lst, 0)
print hasIndex(lst, 2)
print hasIndex(lst, 3)
print hasIndex(lst, -1)
print hasIndex(lst, -3)
print hasIndex(lst, -4)
--------------------------------
1
1
0
1
1
0
================================
==== hasIndex: string
================================
s = "abc"
print hasIndex(s, 0)
print hasIndex(s, 2)
print hasIndex(s, 3)
print hasIndex(s, -1)
--------------------------------
1
1
0
1
================================
==== hasIndex: map
================================
m = {"a": 1}
print hasIndex(m, "a")
print hasIndex(m, "b")
--------------------------------
1
0
================================
==== values: map
================================
m = {"a": 10}
print values(m)
--------------------------------
[10]
================================
==== values: string (characters)
================================
print values("abc")
--------------------------------
["a", "b", "c"]
================================
==== range: basic
================================
print range(1, 5)
--------------------------------
[1, 2, 3, 4, 5]
================================
==== range: with step
================================
print range(0, 10, 3)
--------------------------------
[0, 3, 6, 9]
================================
==== range: descending
================================
print range(5, 1)
--------------------------------
[5, 4, 3, 2, 1]
================================
==== range: single element
================================
print range(3, 3)
--------------------------------
[3]
================================
================================================================================
==== SECTION 25: FOR OVER RANGE
================================================================================
==== Basic for over range
================================
for i in range(1, 5)
	print i
end for
--------------------------------
1
2
3
4
5
================================
==== For over range with step
================================
for i in range(0, 10, 3)
	print i
end for
--------------------------------
0
3
6
9
================================
==== For over range descending
================================
for i in range(3, 1)
	print i
end for
--------------------------------
3
2
1
================================
==== For over range with accumulator
================================
total = 0
for i in range(1, 4)
	total += i
end for
print total
--------------------------------
10
================================
================================================================================
==== SECTION 26: CLOSURES
================================================================================
==== Closure captures outer variable
================================
makeAdder = function(n)
	return function(x)
		return x + n
	end function
end function
add5 = makeAdder(5)
print add5(10)
print add5(100)
--------------------------------
15
105
================================
==== Closure captures multiple outer variables
================================
makeLine = function(m, b)
	return function(x)
		return m * x + b
	end function
end function
f = makeLine(2, 3)
print f(0)
print f(5)
print f(10)
--------------------------------
3
13
23
================================
==== Multiple closures from same outer call
================================
makePair = function(val)
	getter = function
		return val
	end function
	setter = function(newVal)
		val = newVal
	end function
	return [getter, setter]
end function
pair = makePair(42)
print pair[0]
--------------------------------
42
================================
==== Closure in a loop
================================
funcs = []
for i in [1, 2, 3]
	push funcs, function
		return i
	end function
end for
// All closures share the same captured scope; i ends at 3
print funcs[0]
print funcs[1]
print funcs[2]
--------------------------------
3
3
3
================================
================================================================================
==== SECTION 27: NULL IN EXPRESSIONS
================================================================================
==== Null arithmetic returns null
================================
print null + 1
--------------------------------
null
================================
print null - 5
--------------------------------
null
================================
print null * 3
--------------------------------
null
================================
print null / 2
--------------------------------
null
================================
==== Null comparisons
================================
print null == null
--------------------------------
1
================================
print null != null
--------------------------------
0
================================
print null == 0
--------------------------------
0
================================
print null == ""
--------------------------------
0
================================
==== Null truthiness
================================
if null then print "truthy" else print "falsy"
--------------------------------
falsy
================================
==== Print null
================================
print null
--------------------------------
null
================================
==== Null in string concatenation (null propagates)
================================
print "value: " + null
--------------------------------
null
================================
================================================================================
==== SECTION 28: TRUE AND FALSE VALUES
================================================================================
==== Print true and false
================================
print true
--------------------------------
1
================================
print false
--------------------------------
0
================================
==== True/false in arithmetic
================================
print true + true
--------------------------------
2
================================
print true * 5
--------------------------------
5
================================
print false + 10
--------------------------------
10
================================
==== True/false in conditions
================================
if true then print "yes" else print "no"
--------------------------------
yes
================================
if false then print "yes" else print "no"
--------------------------------
no
================================
==== True/false in variables
================================
x = true
y = false
print x
print y
print x + y
--------------------------------
1
0
1
================================
==== True/false comparisons
================================
print true == 1
--------------------------------
1
================================
print false == 0
--------------------------------
1
================================
print true != false
--------------------------------
1
================================
================================================================================
==== SECTION 29: CHAINED COMPARISONS
================================================================================
==== MiniScript supports Python-style chained comparisons:
==== a < b <= c means (a < b) and (b <= c)
================================
==== All parts true
================================
print 1 < 3 <= 5
--------------------------------
1
================================
==== First part false
================================
print 5 < 3 <= 5
--------------------------------
0
================================
==== Second part false
================================
print 1 < 3 <= 0
--------------------------------
0
================================
==== Ascending chain
================================
print 1 < 2 < 3
--------------------------------
1
================================
==== Descending chain with >=
================================
print 3 > 2 >= 1
--------------------------------
1
================================
==== Mixed operators
================================
print 1 < 2 > 0
--------------------------------
1
================================
==== Equality chain
================================
print 2 == 2 == 2
--------------------------------
1
================================
==== Equality chain (false)
================================
print 1 == 2 == 2
--------------------------------
0
================================
==== Non-chained comparison still works
================================
print 3 > 2
--------------------------------
1
================================
==== Side-effect evaluation order: each operand evaluated exactly once
==== Uses a list as mutable state shared via closure
================================
state = [-1, 10, 20, 30]
f = function(s)
	s[0] = s[0] + 1
	return s[s[0]]
end function
print f(state) < f(state) < f(state)
--------------------------------
1
================================
================================================================================
==== SECTION: LIST TYPE MAP AND DOT-SYNTAX METHODS
================================================================================
x = [1, 2, 3]
print x.pop; print x
--------------------------------
3
[1, 2]
================================
x = [1, 2, 3]; x.push 4; print x
--------------------------------
[1, 2, 3, 4]
================================
x = [1, 2, 3]
print x.pull; print x
--------------------------------
1
[2, 3]
================================
x = [1, 2, 3]; print x.len
--------------------------------
3
================================
x = [1, 2, 3]; print x.indexOf(2)
--------------------------------
1
================================
x = [1, 2, 3]; print x.sum
--------------------------------
6
================================
x = [10, 30, 20]; x.sort; print x
--------------------------------
[10, 20, 30]
================================
x = [1, 2, 3]; print x.join("-")
--------------------------------
1-2-3
================================
x = [1, 2, 3]; x.insert 1, 99; print x
--------------------------------
[1, 99, 2, 3]
================================
x = [1, 2, 3]; x.remove 1; print x
--------------------------------
[1, 3]
================================
x = [1, 2, 3]; print x.indexes
--------------------------------
[0, 1, 2]
================================
x = [1, 2, 3]; print x.hasIndex(2)
--------------------------------
1
================================
x = [1, 2, 3]; print x.hasIndex(5)
--------------------------------
0
================================
x = [1, 2, 3]; print x.values
--------------------------------
[1, 2, 3]
================================
==== END OF TESTS
================================================================================

